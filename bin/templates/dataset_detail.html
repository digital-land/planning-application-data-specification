{% extends "base.html" %}
{% set spec_route = "decisions" %}

{% block content %}
<a class="govuk-back-link" href="{{ links.back }}">Back to datasets</a>
<div class='govuk-grid-row'>
  <div class='govuk-grid-column-full'>
    <span class="govuk-caption-xl">Dataset in decision spec</span>
    <h1 class="govuk-heading-xl">{{ title }}</h1>
  </div>
</div>
  
<div class='govuk-grid-row'>
  <div class='govuk-grid-column-three-quarters'>
    {% if description %}<p class="govuk-body-l">{{ description }}</p>{% endif %}

  {% if fields %}
    <h2 class="govuk-heading-l">Fields</h2>
    <dl class="govuk-summary-list govuk-!-margin-top-3">
      {% for field in fields %}
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">{{ field.name }}</dt>
          <dd class="govuk-summary-list__value">
            <div class="app-field-details__attrs">
              {% if field.description %}
                <p class="govuk-body">{{ field.description | safe }}</p>
              {% endif %}
              <p class="govuk-hint govuk-!-margin-bottom-1">Reference: <code>{{ field.ref }}</code></p>
              {% if field.cardinality %}
                <p class="govuk-hint govuk-!-margin-bottom-1">Cardinality: {{ field.cardinality }}</p>
              {% endif %}
              {% if field.target_dataset %}
                <p class="govuk-body">Links to dataset: <a class="govuk-link" href="{{ field.target_dataset_href }}">{{ field.target_dataset }}</a></p>
              {% endif %}
            </div>
            {% if field.satisfactions %}
            <details class="govuk-details govuk-!-margin-top-2">
              <summary class="govuk-details__summary">
                <span class="govuk-details__summary-text">Needs this field satisfies</span>
              </summary>
              <div class="govuk-details__text">
                <p class="govuk-body">Fields should only be added if they satisfy a user need. This field helps satisfy the following needs.</p>
                <ul class="govuk-list govuk-list--bullet">
                  {% for sat in field.satisfactions %}
                    <li>{{ sat.text | safe }}</li>
                  {% endfor %}
                </ul>
              </div>
            </details>
            {% else %}
            <p class="app-secondary-text">No needs satisfied by this field.</p>
            {% endif %}
          </dd>
        </div>
      {% endfor %}
    </dl>
  {% endif %}

    <h2 class="govuk-heading-l govuk-!-margin-top-9">Needs satisfied by this dataset</h2>
    <p class="govuk-body">Datasets should only be included in the specification if they satisfy user needs.</p>
    {% if needs %}
        {% for item in needs %}
          <details class="govuk-details govuk-!-margin-bottom-3">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text">{{ item.need_id }} {{ "fully" if item.satisfaction == "full" else item.satisfaction }} satisfied, confidence {{ item.confidence or "unknown" }}</span>
            </summary>
            <div class="govuk-details__text">
              <p class="govuk-body">Linked need: <a class="govuk-link" href="{{ item.need_href }}">{{ item.need_id }}</a></p>
              <p class="govuk-body">Justification record: {{ item.just_id }}</p>
              {% if item.justification_body %}
                <div class="govuk-body">{{ item.justification_body | safe }}</div>
              {% elif item.notes %}
                {{ item.notes | safe }}
              {% endif %}
            </div>
          </details>
        {% endfor %}
    {% else %}
      <p class="govuk-hint">No recorded links yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
