{% extends "base.html" %}
{% set spec_route = "decisions" %}

{% block content %}
<a class="govuk-back-link" href="{{ links.back }}">Back to datasets</a>
<div class='govuk-grid-row'>
  <div class='govuk-grid-column-full'>
    <span class="govuk-caption-xl">Dataset in decision spec</span>
    <h1 class="govuk-heading-xl">{{ title }}</h1>
  </div>
</div>
  
<div class='govuk-grid-row'>
  <div class='govuk-grid-column-three-quarters'>
    {% if description %}<p class="govuk-body">{{ description }}</p>{% endif %}

    {% if fields %}
      <h2 class="govuk-heading-l">Fields</h2>
      <div class="govuk-!-margin-top-3">
        {% for field in fields %}
          <div class="govuk-summary-card govuk-!-margin-bottom-3">
            <div class="govuk-summary-card__title-wrapper">
              <h3 class="govuk-summary-card__title">{{ field.name }}</h3>
              <span class="govuk-tag govuk-tag--grey">{{ field.ref }}</span>
            </div>
            <div class="govuk-summary-card__content">
              {% if field.description %}
                <p class="govuk-body">{{ field.description | safe }}</p>
              {% endif %}
              {% if field.cardinality %}
                <p class="govuk-hint govuk-!-margin-bottom-0">Cardinality: {{ field.cardinality }}</p>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <h2 class="govuk-heading-l govuk-!-margin-top-9">Needs satisfied by this dataset</h2>
    {% if needs %}
        {% for item in needs %}
          <details class="govuk-details govuk-!-margin-bottom-3">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text">{{ item.need_id }} {{ "fully" if item.satisfaction == "full" else item.satisfaction }} satisfied, confidence {{ item.confidence or "unknown" }}</span>
            </summary>
            <div class="govuk-details__text">
              <p class="govuk-body">Linked need: <a class="govuk-link" href="{{ item.need_href }}">{{ item.need_id }}</a></p>
              <p class="govuk-body">Justification record: {{ item.just_id }}</p>
              {% if item.justification_body %}
                <div class="govuk-body">{{ item.justification_body | safe }}</div>
              {% elif item.notes %}
                {{ item.notes | safe }}
              {% endif %}
            </div>
          </details>
        {% endfor %}
    {% else %}
      <p class="govuk-hint">No recorded links yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
